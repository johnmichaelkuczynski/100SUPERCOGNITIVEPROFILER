<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"></script>
</head>
<body>
    <h1>Math Fix Test</h1>
    
    <div id="test-content">
        <p>Problem 1: Multivariable Limit</p>
        <p>Evaluate the limit:</p>
        <p>lim_{(x,y) rightarrow (0,0)} frac{x^2 y}{x^4 + y^2}</p>
        <p>Solution:</p>
        <p>Approach along y = kx^2:</p>
        <p>lim(x rightarrow 0) frac{x^2 (kx^2)}{x^4 + (kx^2)^2} = lim(x rightarrow 0) frac{kx^4}{x^4 + k^2x^4} = frac{k}{1 + k^2}</p>
        <p>Since the limit depends on k, the limit does not exist.</p>
        <p>Problem 2: Advanced Integration</p>
        <p>Compute the integral:</p>
        <p>int frac{x^3 - 2x^2 + 3x + 4}{(x^2 + 1)(x^2 - 2x + 2)} dx</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                console.log('Converting unwrapped math expressions to proper LaTeX...');
                
                // Convert unwrapped math to proper LaTeX delimiters
                const content = document.getElementById('test-content');
                let html = content.innerHTML;
                
                // Convert fractions
                html = html.replace(/frac\{([^}]+)\}\{([^}]+)\}/g, '\\(\\frac{$1}{$2}\\)');
                
                // Convert limits
                html = html.replace(/lim_\{([^}]+)\}/g, '\\(\\lim_{$1}\\)');
                html = html.replace(/lim\(([^)]+)\)/g, '\\(\\lim $1\\)');
                
                // Convert integrals
                html = html.replace(/int /g, '\\(\\int \\)');
                
                // Convert rightarrow
                html = html.replace(/rightarrow/g, '\\(\\rightarrow\\)');
                
                // Convert simple expressions
                html = html.replace(/\b([a-zA-Z]+)\^(\d+|\{[^}]+\})/g, '\\($1^$2\\)');
                
                content.innerHTML = html;
                
                // Now render with KaTeX
                if (window.renderMathInElement) {
                    window.renderMathInElement(content, {
                        delimiters: [
                            {left: "$$", right: "$$", display: true},
                            {left: "\\(", right: "\\)", display: false}
                        ],
                        throwOnError: false
                    });
                    console.log('KaTeX rendering complete');
                } else {
                    console.log('KaTeX not available');
                }
            }, 500);
        });
    </script>
</body>
</html>